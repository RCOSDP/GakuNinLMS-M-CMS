<html>

<head>
  <title>test page</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <button onclick="file1()">open directory</button>
  <button onclick="file2()">getPptx</button>
  <button onclick="file3()">createImportJson</button>
  <button onclick="file4()">test</button>
  <br><br>
  <a id="down">download</a>
  <br><br>
  <canvas id="canvas" width="240" height="240"></canvas>
  <br><br>
  <textarea id="msgbox" rows=5 cols=80></textarea>
  <br><br>
  <video id="video" width="640" height="400" controls></video>
</body>

<script src="browser.js"></script>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const down = document.getElementById('down');

let pptx;

const {setRoot, readFile, writeFile, openDir} = ppt2video;

function arraybuffer2string(buf) {
  return String.fromCharCode.apply("", new Uint8Array(buf));
}

async function file1() {
  const dirHandle = await window.showDirectoryPicker();
  setRoot(dirHandle);
}

async function file2() {
  pptx = await ppt2video.getPptx('vuca.pptx');
  await pptx.init();
}

async function file3() {
  const ij = pptx.createImportJson();
  console.log(ij);
}

async function test1() {
  const ib = await ppt2video.imageFile2ImageBitmap("スライド1.PNG", "vuca");
  const vf = new VideoFrame(ib,{timestamp: 0});
  await ctx.drawImage(vf,0,0);
}

async function file4() {
  await ppt2video.readSoundFileTopic(pptx.sections[2].topics[0]);
  const chunks = await ppt2video.encodeTopic(pptx.sections[2].topics[0]);
  const blob = new Blob(chunks, {type: "application/octet-stream"})
  const url = URL.createObjectURL(blob);
  down.href = url;
  down.download = "down.h264";
}
</script>
